<!DOCTYPE html>
<html lang="sw">
<head>
<meta charset="UTF-8">
<title>Clark Online Dating â€“ Chat</title>
<style>
body{margin:0;font-family:Arial;text-align:center;overflow:hidden;}
.bgDiv{position:fixed;inset:0;background-size:cover;opacity:0;transition:1.5s;filter:blur(2px);z-index:-2;}
.bgDiv.active{opacity:1;}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:-1;}
header{background:rgba(255,77,109,.8);color:white;padding:15px;}
.chatBox{
  margin:30px auto;background:rgba(255,255,255,.85);
  width:90%;max-width:600px;padding:15px;border-radius:8px;
}
#messages{height:300px;overflow:auto;border:1px solid #ccc;padding:5px;margin:10px 0;}
input,select,button{padding:8px;margin:3px;width:90%;}
button{background:#ff4d6d;color:white;border:none;cursor:pointer;}
</style>
</head>
<body>

<div id="bg1" class="bgDiv"></div>
<div id="bg2" class="bgDiv"></div>
<div class="overlay"></div>

<header>
<h2>Clark Private Chat</h2>
<button id="logout">Logout</button>
</header>

<div class="chatBox">
  <select id="users"></select>
  <div id="messages"></div>
  <input id="msg" placeholder="Message">
  <button id="send">Send</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
 apiKey:"AIzaSyD_FcmcZpcCix8JMrP49w-KZd1N3c_EWho",
 authDomain:"clark-dating.firebaseapp.com",
 projectId:"clark-dating",
 appId:"1:274706009108:web:6e7309d20e788bc790ab01"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let me;

onAuthStateChanged(auth,u=>{
 if(!u) location="login.html";
 me=u.uid;
 loadMessages();
});

logout.onclick=()=>signOut(auth);

send.onclick=async()=>{
 const m=msg.value.trim(); if(!m) return;
 await addDoc(collection(db,"publicMessages"),{
   from:me,message:m,timestamp:Date.now()
 });
 msg.value="";
};

function loadMessages(){
 const q=query(collection(db,"publicMessages"),orderBy("timestamp"));
 onSnapshot(q,snap=>{
   messages.innerHTML="";
   snap.forEach(doc=>{
     const d=doc.data();
     const div=document.createElement("div");
     div.textContent=d.message;
     messages.appendChild(div);
   });
   messages.scrollTop=messages.scrollHeight;
 });
}

/* Background crossfade */
const images = [
  "https://images.pexels.com/photos/415829/pexels-photo-415829.jpeg",
  "https://images.pexels.com/photos/774909/pexels-photo-774909.jpeg",
  "https://images.pexels.com/photos/1181686/pexels-photo-1181686.jpeg",
  "https://images.pexels.com/photos/3769713/pexels-photo-3769713.jpeg"
];
let i=0,cur=1;
function bg(){
 const a=bg1,b=bg2,img=images[i++%images.length];
 if(cur===1){b.style.backgroundImage=`url(${img})`;b.classList.add("active");a.classList.remove("active");cur=2;}
 else{a.style.backgroundImage=`url(${img})`;a.classList.add("active");b.classList.remove("active");cur=1;}
}
bg();setInterval(bg,5000);
</script>
</body>
</html>
